<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ödeme Başarılı - Satınalma CoPilot</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Inter',sans-serif;background:linear-gradient(135deg,#10b981,#059669);min-height:100vh;padding:20px}
    .success-container{min-height:100vh;display:flex;align-items:center;justify-content:center}
    .success-card{background:#fff;border-radius:20px;padding:60px 40px;max-width:720px;width:100%;text-align:center;box-shadow:0 20px 40px rgba(0,0,0,.1);position:relative;overflow:hidden}
    .success-card::before{content:'';position:absolute;top:0;left:0;right:0;height:4px;background:linear-gradient(90deg,#10b981,#2563eb,#7c3aed)}
    .success-icon{font-size:4rem;margin-bottom:24px;animation:bounce 2s infinite}
    @keyframes bounce{0%,20%,50%,80%,100%{transform:translateY(0)}40%{transform:translateY(-10px)}60%{transform:translateY(-5px)}}
    .success-title{font-size:2.4rem;font-weight:700;color:#1e293b;margin-bottom:12px}
    .success-subtitle{font-size:1.05rem;color:#64748b;margin-bottom:28px;line-height:1.6}
    .plan-summary{background:linear-gradient(135deg,#f8fafc 0%,#e2e8f0 100%);border-radius:16px;padding:24px;margin:26px 0;text-align:left;border-left:4px solid #2563eb}
    .plan-summary h3{color:#1e293b;font-weight:600;margin-bottom:14px;text-align:center}
    .plan-detail{display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid #e2e8f0}
    .plan-detail:last-child{border-bottom:none}
    .label{color:#64748b;font-weight:500}
    .value{color:#1e293b;font-weight:600}
    .steps-container{background:#f8fafc;border-radius:16px;padding:26px;margin:30px 0;text-align:left}
    .steps-title{font-size:1.1rem;font-weight:600;color:#1e293b;margin-bottom:14px;text-align:center}
    .step{display:flex;align-items:flex-start;gap:16px;margin-bottom:14px;padding:14px;background:#fff;border-radius:12px;border-left:4px solid #10b981}
    .step-number{background:#10b981;color:#fff;width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;flex-shrink:0}
    .whatsapp-info{background:#dcfce7;border:2px solid #10b981;border-radius:12px;padding:20px;margin:24px 0}
    .whatsapp-number{font-size:1.4rem;font-weight:800;color:#059669;margin:6px 0}
    .whatsapp-button{background:#25d366;color:#fff;text-decoration:none;padding:14px 28px;border-radius:12px;font-weight:700;display:inline-flex;align-items:center;gap:8px;margin:16px 0;transition:.3s}
    .whatsapp-button:hover{background:#20c757;transform:translateY(-2px)}
    .payment-info{background:#dcfce7;border:1px solid #10b981;border-radius:12px;padding:18px;margin:20px 0;color:#166534}
    .footer-links{margin-top:30px;padding-top:20px;border-top:1px solid #e2e8f0}
    .footer-links a{color:#2563eb;text-decoration:none;margin:0 12px;font-weight:600}
    .footer-links a:hover{text-decoration:underline}
    .example-commands{background:#f1f5f9;border-radius:12px;padding:18px;margin:22px 0;text-align:left}
    .example-commands h4{color:#1e293b;margin-bottom:10px;text-align:center}
    .example-commands li{background:#fff;margin:8px 0;padding:10px;border-radius:8px;border-left:3px solid #2563eb;font-family:'Courier New',monospace;font-size:.9rem;color:#1e293b;list-style:none}
    @media (max-width:768px){.success-card{padding:40px 24px;margin:0 12px}.success-title{font-size:2rem}}
  </style>
</head>
<body>
  <div class="success-container">
    <div class="success-card">
      <div class="success-icon">🎉</div>
      <h1 class="success-title" id="mainTitle">Ödeme Başarılı!</h1>
      <p class="success-subtitle" id="mainSubtitle">
        Planınız aktifleştirildi. WhatsApp asistanınız şimdi tam kapasiteyle çalışıyor!
      </p>

      <!-- Ödeme bilgileri -->
      <div class="plan-summary" id="planSummary" style="display:none">
        <h3>📋 Plan Detayları</h3>
        <div class="plan-detail"><span class="label">Seçilen Plan:</span><span class="value" id="planName">-</span></div>
        <div class="plan-detail"><span class="label">Mesaj Kotası:</span><span class="value" id="planQuota">-</span></div>
        <div class="plan-detail"><span class="label">Faturalama:</span><span class="value" id="planBilling">-</span></div>
        <div class="plan-detail"><span class="label">Toplam Ödeme:</span><span class="value" id="planPrice">-</span></div>
      </div>

      <div class="payment-info" id="paymentInfo" style="display:none">
        <strong>✅ Ödeme Onaylandı</strong> — Plan haklarınız yüklendi.
      </div>

      <div class="whatsapp-info">
        <p><strong>WhatsApp Asistan Numarası:</strong></p>
        <div class="whatsapp-number">+1 (415) 523-8886</div>
        <p>Bu numarayı WhatsApp'ta kaydedin ve ilk mesajınızı atın!</p>
        <a class="whatsapp-button" id="waBtn" target="_blank" href="https://wa.me/14155238886?text=Merhaba">
          📱 WhatsApp'ta Mesaj Gönder
        </a>
      </div>

      <div class="steps-container">
        <h3 class="steps-title">🚀 Başlamak için 3 adım</h3>
        <div class="step"><div class="step-number">1</div><div><strong>Numarayı Kaydedin</strong><br/>+1 (415) 523-8886 → “Satınalma CoPilot”</div></div>
        <div class="step"><div class="step-number">2</div><div><strong>İlk Mesaj</strong><br/>“Merhaba” yazarak asistanı aktifleştirin</div></div>
        <div class="step"><div class="step-number">3</div><div><strong>İhtiyacınızı Yazın</strong><br/>“RFQ başlat: 1000 adet vida” gibi</div></div>
      </div>

      <div class="example-commands">
        <h4>💡 İlk Deneme Önerileri</h4>
        <ul>
          <li>"Hangi firmalar alüminyum profil üretiyor?"</li>
          <li>"Bosch Türkiye hakkında risk analizi"</li>
          <li>"RFQ başlat: 1000 adet vida"</li>
          <li>"Çelik pazarında fiyat trendleri"</li>
        </ul>
      </div>

      <div class="footer-links">
        <a href="mailto:info@satinalmacopilot.com">📧 Destek</a>
        <a href="tel:+905520710977">📞 Yardım</a>
        <a href="index.html">🏠 Ana Sayfa</a>
      </div>
    </div>
  </div>

  <script>
    // Backend URL (opsiyonel durum sorgusu için)
    const API_BASE_URL = "https://api.satinalmacopilot.com";

    // Plan konfigürasyonları
    const planConfig = {
      basic:{ name:'Basic',  monthly:{price:7.95, quota:500},  yearly:{price:47.40, quota:6000}},
      pro:  { name:'Pro',    monthly:{price:17.95,quota:1500}, yearly:{price:107.40,quota:18000}},
      max:  { name:'Max',    monthly:{price:39.95,quota:5000}, yearly:{price:239.40,quota:60000}}
    };

    // URL parametrelerini al
    const params   = new URLSearchParams(location.search);
    const orderId  = params.get('order');
    const phone    = params.get('phone');
    const planKey  = params.get('plan')    || 'pro';
    const billing  = params.get('billing') || 'monthly';
    const isPayment= params.get('payment') === 'success' || !!orderId;

    // WhatsApp linkini kişiselleştir
    if (phone) {
      const msg = isPayment ? 'Merhaba, planımı yeni aktifleştirdim!' : 'Merhaba, yeni kaydoldum!';
      document.getElementById('waBtn').href = `https://wa.me/14155238886?text=${encodeURIComponent(msg)}`;
    }

    function fillPaidUI() {
      const plan = planConfig[planKey];
      if (plan) {
        const data = plan[billing] || plan.monthly;
        document.getElementById('planSummary').style.display = 'block';
        document.getElementById('paymentInfo').style.display = 'block';
        document.getElementById('planName').textContent   = plan.name;
        document.getElementById('planQuota').textContent  = data.quota.toLocaleString() + ' mesaj/' + (billing==='monthly'?'ay':'yıl');
        document.getElementById('planBilling').textContent= (billing==='monthly'?'Aylık':'Yıllık');
        document.getElementById('planPrice').textContent  = '$' + data.price.toFixed(2); // ← düzeltildi
      }
    }

    async function maybeCheckOrder() {
      if (!orderId) { if (isPayment) fillPaidUI(); return; }
      try {
        const r = await fetch(`${API_BASE_URL}/api/payment/status/${orderId}`);
        if (r.ok) {
          const j = await r.json();
          if (j.status === 'completed') fillPaidUI();
        }
      } catch(e) {/* sessiz geç */}
    }

    document.addEventListener('DOMContentLoaded', ()=>{
      // kutlama efekti
      createConfetti();
      maybeCheckOrder();
      // 5 sn sonra WhatsApp açma promptu
      setTimeout(()=>{
        const go = confirm("WhatsApp'ı şimdi açmak ister misiniz?");
        if (go) window.open(document.getElementById('waBtn').href,'_blank');
      },5000);
    });

    function createConfetti(){
      const colors=['#2563eb','#10b981','#f59e0b','#ef4444','#8b5cf6'];
      for(let i=0;i<50;i++){
        setTimeout(()=>{
          const c=document.createElement('div');
          c.style.cssText='position:fixed;width:10px;height:10px;border-radius:50%;pointer-events:none;z-index:9999';
          c.style.backgroundColor=colors[Math.floor(Math.random()*colors.length)];
          c.style.left=Math.random()*100+'vw'; c.style.top='-10px';
          document.body.appendChild(c);
          c.animate([{transform:'translateY(0) rotate(0)',opacity:1},{transform:'translateY(100vh) rotate(360deg)',opacity:0}],{duration:3000,easing:'linear'}).onfinish=()=>c.remove();
        },i*80);
      }
    }
  </script>
</body>
</html>
